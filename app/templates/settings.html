{% extends "base.html" %}

{% block title %}Nastavenia - PlannerX{% endblock %}

{% block content %}
<div class="settings-page">
    <h1>⚙️ Nastavenia</h1>

    <div class="card">
        <h2>Denný digest</h2>
        <form id="settingsForm">
            <div class="form-group">
                <label>
                    <input type="checkbox" name="digest_enabled" {% if user.digest_enabled %}checked{% endif %}>
                    Povoliť denný digest emailom
                </label>
            </div>

            <div class="form-group">
                <label>Čas odoslania:</label>
                <input type="time" name="digest_time" value="{{ user.digest_time }}">
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" name="sms_enabled" {% if user.sms_enabled %}checked{% endif %}>
                    Povoliť SMS notifikácie
                </label>
            </div>

            <div class="form-group">
                <label>Telefónne číslo (pre SMS):</label>
                <input type="tel" name="phone_number" value="{{ user.phone_number or '' }}" placeholder="+421...">
            </div>

            <button type="submit" class="btn btn-primary">Uložiť</button>
        </form>
    </div>

    <div class="card">
        <h2>O aplikácii</h2>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Účet vytvorený:</strong> {{ user.created_at.strftime('%d.%m.%Y') if user.created_at else 'N/A' }}</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('settingsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Convert checkboxes to boolean
    data.digest_enabled = formData.has('digest_enabled');
    data.sms_enabled = formData.has('sms_enabled');
    
    const response = await fetch('/settings/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });
    
    if (response.ok) {
        PlannerX.showNotification('Nastavenia uložené!', 'success');
    } else {
        PlannerX.showNotification('Chyba pri ukladaní nastavení', 'error');
    }
});
</script>
{% endblock %}

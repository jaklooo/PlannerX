{% extends "base.html" %}

{% block title %}Nastavenia - PlannerX{% endblock %}

{% block content %}
<div class="settings-page container" style="padding-top: 2rem;">
    <div class="glass-tile" style="text-align: center; margin-bottom: 2rem; padding: 2rem;">
        <h1 style="color: var(--text-primary); margin: 0; font-size: 2.5rem;">⚙️ Nastavenia</h1>
    </div>

    <div class="glass-tile card" style="margin-bottom: 2rem; padding: 2rem;">
        <h2 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.5rem; border-bottom: 2px solid var(--wood-accent); padding-bottom: 0.5rem;">Denný digest</h2>
        <form id="settingsForm" style="display: flex; flex-direction: column; gap: 1.5rem;">
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-primary); font-weight: 500;">
                    <input type="checkbox" name="digest_enabled" {% if user.digest_enabled %}checked{% endif %} style="width: 18px; height: 18px;">
                    Povoliť denný digest emailom
                </label>
            </div>

            <div class="form-group">
                <label style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Čas odoslania:</label>
                <input type="time" name="digest_time" value="{{ user.digest_time }}" class="input-glass" style="padding: 0.75rem; max-width: 200px;">
            </div>

            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 0.75rem; color: var(--text-primary); font-weight: 500;">
                    <input type="checkbox" name="sms_enabled" {% if user.sms_enabled %}checked{% endif %} style="width: 18px; height: 18px;">
                    Povoliť SMS notifikácie
                </label>
            </div>

            <div class="form-group">
                <label style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Telefónne číslo (pre SMS):</label>
                <input type="tel" name="phone_number" value="{{ user.phone_number or '' }}" placeholder="+421..." class="input-glass" style="padding: 0.75rem; max-width: 300px;">
            </div>

            <button type="submit" class="btn btn-glass-primary" style="padding: 0.75rem 1.5rem; font-size: 1.1rem; align-self: flex-start;">Uložiť</button>
        </form>
    </div>

    <div class="glass-tile card" style="padding: 2rem;">
        <h2 style="color: var(--text-primary); margin-bottom: 1.5rem; font-size: 1.5rem; border-bottom: 2px solid var(--wood-accent); padding-bottom: 0.5rem;">O aplikácii</h2>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <p style="color: var(--text-secondary); margin: 0;"><strong style="color: var(--text-primary);">Email:</strong> {{ user.email }}</p>
            <p style="color: var(--text-secondary); margin: 0;"><strong style="color: var(--text-primary);">Účet vytvorený:</strong> {{ user.created_at.strftime('%d.%m.%Y') if user.created_at else 'N/A' }}</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('settingsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    // Convert checkboxes to boolean
    data.digest_enabled = formData.has('digest_enabled');
    data.sms_enabled = formData.has('sms_enabled');
    
    const response = await fetch('/settings/update', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });
    
    if (response.ok) {
        PlannerX.showNotification('Nastavenia uložené!', 'success');
    } else {
        PlannerX.showNotification('Chyba pri ukladaní nastavení', 'error');
    }
});
</script>
{% endblock %}
